<!DOCTYPE html>
<html>

<head>
    {include file="global.php" title="按钮列表"/}
</head>

<body class="admin-body">
    <div class="layui-fluid">
        <div class="layui-card">
            <div class="layui-form layui-card-header admin-card-header-auto">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <div class="layui-input-inline admin-input-comm search">
                            <input type="text" id="key" placeholder="请输入编号、按钮名" autocomplete="off" class="layui-input">
                        </div>
                        <button class="layui-btn admin-btn-comm" lay-submit onclick="search();">
                            <i class="layui-icon icon-search admin-button-btn"></i>搜索
                        </button>
                    </div>
                </div>
            </div>
            <div class="layui-card-body admin-table-body">
                <table id="data-table" lay-filter="data-table"></table>
            </div>
        </div>
    </div>
    <script>
        var tableId = "data-table";
        //数据表格
        layui.use('table', function() {
            var table = layui.table;
            //表格渲染
            table.render({
                elem: '#' + tableId,
                height: tableHelper.setHeight(tableId),
                url: '/module/getModuleButtonList?moduleId=<?php echo $_GET["moduleId"]?>', //数据接口
                page: true, //开启分页
                cols: [
                    [ //表头
                        { field: 'id', title: '编号', width: 80, sort: true, align: 'center' },
                        { field: 'name', title: '按钮名', width: 120, align: 'center' },
                        { field: 'englishName', title: '按钮英文名', width: 120, align: 'center' },
                        {
                            field: 'isRelation',
                            title: '是否关联',
                            width: 100,
                            align: 'center',
                            templet: function(d) {
                                return d[this.field] ? '<i class="icon icon-true"></i>' : '<i class="icon icon-false"></i>';
                            }
                        },
                        {
                            field: 'menu',
                            title: '操作',
                            width: 100,
                            align: 'center',
                            templet: function(d) {
                                //创建按钮,传入按钮名与对应方法，及颜色样式{0原始,1默认,2百搭,3暖色,4警告,5禁用},不设置为默认颜色
                                var button = { relation: ['关联按钮', 1] };
                                if (d.isRelation) {
                                    button = { delRelation: ['取消关联', 0] };
                                }
                                return tableHelper.createButton(button, d);
                            }
                        }
                    ]
                ]
            });
        });

        //操作方法

        //添加关联
        function relation(d) {
            askHelper.ajaxPost({
                url: '/module/relation',
                data: { buttonId: d.id, moduleId: d.moduleId },
                success: function() {
                    tableHelper.refresh('data-table');
                }
            });
        }

        //删除关联
        function delRelation(d) {
            askHelper.ajaxPost({
                url: '/module/delRelation',
                data: { buttonId: d.id, moduleId: d.moduleId },
                success: function() {
                    tableHelper.refresh('data-table');
                }
            });
        }

        //搜索
        function search() {
            //执行重载
            layui.table.reload(tableId, {
                page: {
                    curr: 1 //重新从第 1 页开始
                },
                where: {
                    key: $.trim($('#key').val())
                }
            });
        }
    </script>
</body>

</html>