$((function(){$.each($(".layui-input-block").find("input,textarea"),(function(i,v){var item,label;($(this).data("auto")&&$(this).attr("placeholder","请输入"+$(this).parent().prev().html()),"required"==$(this).attr("lay-verify"))&&$(this).parents(".layui-form-item").find(".layui-form-label").addClass("icon-required")})),$.each($('input[lay-skin="switch"]'),(function(i,v){$(v).attr("type","hidden").val(this.checked?1:0)})),layui.use(["form"],(function(){var form;layui.form.on("switch",(function(data){$(data.elem).attr("type","hidden").val(this.checked?1:0)}))})),$(".datagrid-wrap").css({width:parseInt($(".datagrid-wrap").width()-2)+"px"}),$(".search input").keydown((function(e){13==e.keyCode&&$(this).parent().next("button").click()}))}));var askHelper={ajaxError:function(xhr,textStatus,error){error=error||function(){};var msg="请求出现错误,状态码:"+xhr.status+",描述:"+textStatus;layer.msg(msg,{time:3e3,icon:5},(function(){error()}))},ajaxPost:function(o){o.success=o.success||function(result){window.parent.isHome?tableHelper.refresh("data-table"):(window.parent.tableHelper.refresh("data-table"),window.parent.layer.closeAll("iframe"))};var msgIndex=0;o.fail=o.fail||function(result){},o.type=o.type||"POST",o.data=o.data||{},o.dataType=o.dataType||"json",o.before=o.before||function(){msgIndex=layer.msg("处理中",{icon:16,shade:.5,time:864e5})},o.original=o.original||!1,$.ajax({url:o.url,type:o.type,async:!0,timeout:6e3,data:o.data,dataType:o.dataType,beforeSend:function(xhr){o.before(xhr)},success:function(result){if(o.original)return msgIndex&&layer.close(layer.msg()),o.success(result);1===result.code?layer.msg(result.msg,{time:500,icon:1},(function(){o.success(result)})):layer.msg(result.msg,{time:2e3,icon:5},(function(){o.fail(result)}))},error:function(xhr,textStatus){askHelper.ajaxError(xhr,textStatus,o.error)}})},ajaxGet:function(o){o.type="GET",askHelper.ajaxPost(o)},ajaxConfirm:function(o){o.cancel=o.cancel||function(){};var index=layer.confirm(o.msg+"？",{btn:["确定","取消"]},(function(){layer.close(index),askHelper.ajaxPost(o)}),(function(){layer.close(index),o.cancel()}))}},tableHelper={setHeight:function(unit=!0){var height=parseInt($(window).height()-$(".admin-card-header-auto").height()-45);return unit?height+"px":height},setPage:function(p){var header=$(".admin-card-header-auto");if(!header||header.length<=0)return p;var height=parseInt($(window).height()-header.height()-45),toolbar=$("#toolbar").length<=0?0:$("#toolbar").outerHeight(),viewHeight,pageSize=parseInt((height-toolbar-65)/35);return Array.isArray(p)?(p.push(pageSize),Array.from(new Set(p)).sort((function(a,b){return a-b}))):pageSize},refresh:function(tableId){var table=$("#"+tableId);table.closest(".datagrid-view").find(".treegrid-tr-tree").length>0?table.treegrid("reload"):table.datagrid("reload")},createButton:function(object,value,clickRow=!0){var btn="",btnList=object,layuiBtn="layui-btn layui-btn-xs",style=["layui-btn-primary","","layui-btn-normal","layui-btn-warm","layui-btn-danger","layui-btn-disabled"];for(var b in"object"==typeof value&&(value=JSON.stringify(value).replace(/\"/g,"'")),btnList)if(btnList.hasOwnProperty(b)){var genre=layuiBtn+" "+(style[btnList[b][1]]||""),data;btn+='<a href="javascript:void(0);" data=\''+(btnList[b][2]||"")+'\' ondblclick="console.log("禁止双击");return false;" onclick="'+b+"("+value+',this);"class="'+genre+'">'+btnList[b][0]+"</a>"}return clickRow||setTimeout((function(){$("table .layui-btn").click((function(e){e.stopPropagation()}))}),1e3),btn}},timeHelper={formatDate:function(time,format){"string"==typeof time&&((time=time.replace(/-/g,"/").replace(/T/g," ")).indexOf(".")>0&&(time=time.substring(0,time.indexOf("."))),time=new Date(time));var o={"M+":time.getMonth()+1,"d+":time.getDate(),"H+":time.getHours(),"m+":time.getMinutes(),"s+":time.getSeconds(),"q+":Math.floor((time.getMonth()+3)/3),S:time.getMilliseconds()};for(var k in/(y+)/.test(format)&&(format=format.replace(RegExp.$1,(time.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+k+")").test(format)&&(format=format.replace(RegExp.$1,1===RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return format}},pictureHelper={showBig:function(t,z){z=z||1;var width=parseInt(t.naturalWidth*z),height=parseInt(t.naturalHeight*z),scale=width/height;width>$(window).width()&&(width=$(window).width()-20),height>$(window).height()&&(width=(height=$(window).height()-20)*scale),layer.open({type:1,title:!1,closeBtn:0,area:width+"px",skin:"layui-layer-nobg",shadeClose:!0,content:'<img src="'+t.src+'" width="'+width+'" height="'+height+'"> '}),$(".layui-layer-content img").click((function(){$(".layui-layer-shade").click()}))},error:function(t,s=!1){t.parentElement.innerHTML=s?"图片损坏或不存在":""}},figuresHelper={longConvert:function(curentNum){for(var strNumSize=function(tempNum){var stringNum=tempNum.toString(),index=stringNum.indexOf("."),newNum=stringNum;return-1!=index&&(newNum=stringNum.substring(0,index)),newNum.length},units=["","万","亿","万亿"],dividend=1e4,curentUnit=units[0],i=0;i<4&&(curentUnit=units[i],!(strNumSize(curentNum)<5));i++)curentNum/=1e4;var result;return{num:parseFloat(curentNum.toFixed(1).replace(".0","")),unit:curentUnit}}};$(document).ajaxSuccess((function(event,xhr,options){var data=xhr.responseJSON;if(data&&0===data.rows&&403===data.code&&$("#again-form").length<=0){var html='<form class="layui-form" style="padding: 20px" id="again-form"><div class="layui-form-item" ><input class="layui-input" id="account" placeholder="账号" lay-verify="required" type="text" autocomplete="off"></div><div class="layui-form-item"><input class="layui-input" id="password" placeholder="密码" lay-verify="required" type="password" autocomplete="off"></div><div class="layui-btn" style="width: 100%" id="again-login">登录</div></form>',open=layer.open({type:1,title:data.msg,shadeClose:!1,shade:.8,area:["380px","240px"],content:html});$.cookie("expire",!0),$("#again-login").click((function(){var form=$(this).parent();askHelper.ajaxPost({url:"/index/signIn",data:{account:form.find("#account").val(),password:form.find("#password").val()},success:function(){layer.close(open)}})}))}}));